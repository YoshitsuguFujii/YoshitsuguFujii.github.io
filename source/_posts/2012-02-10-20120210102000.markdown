---
layout: post
title: 既存のメソッドをすり替える方法
date: 2012-02-10 10:20
comments: true
categories: [ruby]
published: true
---

  


すでにあるメソッドに処理を追加したい場合。  
すでにあるメソッドを踏襲した新しいメソッドを定義して、メソッドの呼び出し側を新しいメソッドに向けることができますが  
現実的でないですね。  
  
ではどうやってすり替えるか。  
実現手段はいくつかあると思いますが、ここではアラウンドエイリアスを使ってみます。  
  
今回はStringのto  _sメソッドを、  
  
文字列(文字列長)  
  
と表示するよう変えてみる。  
  
今日のコードではaliasを使いますが、二度呼ぶとエラーとなってしまうのでirbを都度起動してください。  

``` ruby
str = "あいう"

str.to_s #=> "あいう"

class String
  alias :old_to_s :to_s

  def to_s
    old_to_s + "(" + length.to_s + ")" 
  end
end

str.to_s #=> "あいう(3)"
str.old_to_s #=> "あいう"
```

  
この前の[rubyのオープンクラス -
なんとなく日々徒然と](http://d.hatena.ne.jp/gogo_sakura/20120207/1328591412)使ってStringクラスにコーディングしていきます。  
  
構文は  
alias 新しいメソッド名 古いメソッド名  
です。  
今回の例ではto  _sにold  _to  _sという別名をつけます。  

``` ruby
str = "あいう"

str.to_s #=> "あいう"

class String
  alias :old_to_s :to_s
end

str.to_s #=> "あいう" 
str.old_to_s #=> "あいう"
```

  
  
それでto  _sを書き換えちゃいます。

``` ruby
  def to_s
    old_to_s + "(" + length.to_s + ")" 
  end
```

  
to  _sが呼ばれた場合は書き換えたメソッドが呼ばれ、old  _to  _sが呼ばれた場合は昔のメソッドが呼ばれる状態です。  
書き換えられたto  _sは昔のto  _sをold  _to  _sで呼び、lengthをそこにくっつけています。  
  
これでメソッドのすり替えが完了です。


