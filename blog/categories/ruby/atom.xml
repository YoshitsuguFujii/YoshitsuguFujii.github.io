<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

    <title><![CDATA[Category: ruby | なんとなく日々徒然と]]></title>
    <link href="http://yoshitsugufujii.github.io/blog/categories/ruby/atom.xml" rel="self"/>
    <link href="http://yoshitsugufujii.github.io/"/>
    <updated>2016-08-24T18:25:48+09:00</updated>
    <id>http://yoshitsugufujii.github.io/</id>
    <author>
        <name><![CDATA[Yoshitsugu Fujii]]></name>
        
      </author>
    <generator uri="http://octopress.org/">Octopress</generator>

    
    <entry>
        <title type="html"><![CDATA[csvなどで多重配列を縦横を入れ替える(行列切り替え)]]></title>
        <link href="http://yoshitsugufujii.github.io/blog/2016/05/09/ruby-transpose/"/>
        <updated>2016-05-09T10:51:15+09:00</updated>
        <id>http://yoshitsugufujii.github.io/blog/2016/05/09/ruby-transpose</id>
        <content type="html"><![CDATA[<p>小ネタです。<br/>
Csvファイルなどで行列を切り替えて出力したい場合はtransposeが便利です。</p>

<!-- more -->


<p></p>

<pre><code class="ruby  ">csv.each{|row| p row.join(",") }  
csv = [["user_name", "age", "gender"], ["藤井", "36", "men"]]  
csv.each{|row| p row.join(",") }  
# =&gt; "user_name,age,gender"  
# =&gt; "藤井,36,men"  

csv.transpose.each{|row| p row.join(",") }  
# =&gt; "user_name,藤井"  
# =&gt; "age,36"  
# =&gt; "gender,men"  
</code></pre>
]]></content>
    </entry>
    
    <entry>
        <title type="html"><![CDATA[Axlsxでコメント表示]]></title>
        <link href="http://yoshitsugufujii.github.io/blog/2016/04/29/axlsx-comment/"/>
        <updated>2016-04-29T14:50:47+09:00</updated>
        <id>http://yoshitsugufujii.github.io/blog/2016/04/29/axlsx-comment</id>
        <content type="html"><![CDATA[<p>Axlsxで常に表示されているコメントとマウスオーバーで表示されるコメント</p>

<p><img src="/images/blog/2016-04-29%2014.53.19.png" alt="Axlsxコメント" /></p>

<!-- more -->


<pre><code class="ruby">require 'axlsx'
package = Axlsx::Package.new
package.use_shared_strings = true
sheet = package.workbook.add_worksheet(name: 'lists')

sheet.add_row(['品名', '単価', '数量', '計'])
sheet.add_row(['にんじん',    80, 1,      '=B2*C2'])
sheet.add_row(['たまねぎ',    50, 2,      '=B3*C3'])
sheet.add_row(['じゃがいも',  40, 2,      '=B4*C4'])
sheet.add_row(['牛肉',       200, 1,      '=B5*C5'])
sheet.add_row(['カレー粉',   150, 1,      '=B6*C6'])
sheet.add_row(['',            '', '総計', '=SUM(D2:D6)'])

#sheet.add_comment :ref =&gt; 'A1', :text =&gt; 'penut machine', :author =&gt; 'crank', :visible =&gt; true
sheet.add_comment(:ref =&gt; 'A1', :author =&gt; 'Bob', :text =&gt; 'Yes We Can!').tap do |comment|
  comment.vml_shape.top_row = 2      # 位置調整用
  comment.vml_shape.left_column = 2  # 位置調整用
  comment.vml_shape.bottom_row = 2   # 位置調整用
  comment.vml_shape.right_column = 4 # 位置調整用
end
sheet.add_comment :ref =&gt; 'A6', :text =&gt; 'rust bucket', :author =&gt; 'PO', :visible =&gt; false

package.serialize('test.xlsx')
</code></pre>
]]></content>
    </entry>
    
    <entry>
        <title type="html"><![CDATA[model.changesで強制的に変更したことにする方法]]></title>
        <link href="http://yoshitsugufujii.github.io/blog/2016/04/11/rails-dirty-mark-changed/"/>
        <updated>2016-04-11T18:26:43+09:00</updated>
        <id>http://yoshitsugufujii.github.io/blog/2016/04/11/rails-dirty-mark-changed</id>
        <content type="html"><![CDATA[<p>RailsのActiveModelのDirtyでは変更前、変更後、変更したかなどモデルクラスの新旧状態が取れる。<br/>
<a href="http://qiita.com/kakkunpakkun/items/b286f789ca8590104ad1">http://qiita.com/kakkunpakkun/items/b286f789ca8590104ad1</a></p>

<p>このdirtyを使って変更してないけど変更したことにしたい(observerを再実行したい時とか)に使える技</p>

<pre><code class="ruby">user = User.first
user.changes # =&gt; {}
user.created_at_will_change! # =&gt; =&gt; 2015-01-16 20:09:59 +0900
user.changes 
# =&gt; {
#  "created_at" =&gt; [
#    [0] 2015-01-16 20:09:59 +0900,
#    [1] 2015-01-16 20:09:59 +0900
#   ]
# }
</code></pre>

<p>属性名_will_change!で新旧に同じ値が設定される。</p>

<p>なんでこんなことやりたかったかっていうとobserverでuserのnameの値が変更されたらapiを叩く処理を書いていたのだけど、急遽全件apiを再実行する必要があり強制的にnameが変更されたことにしたかったため調べたらあったというお話</p>
]]></content>
    </entry>
    
    <entry>
        <title type="html"><![CDATA[[小ネタ]Railsを使っていてAngularのform validationだけしたい時]]></title>
        <link href="http://yoshitsugufujii.github.io/blog/2016/03/23/angular-with-rails-name-convention/"/>
        <updated>2016-03-23T12:36:53+09:00</updated>
        <id>http://yoshitsugufujii.github.io/blog/2016/03/23/angular-with-rails-name-convention</id>
        <content type="html"><![CDATA[<p>railsでシステムを作っていて、ここはゴリゴリ書くようなところじゃないけどformのvalidationだけangularの機能使いたくなったんですが。
railsはname属性に[]を使うので、この場合のng-show内部の指定がわからなかったので備忘録も兼ねて。</p>

<pre><code class="erb">form name="new_form"
  input name="price[hoge]" ng-model="price" ng-pattern="/^([1-9]\\d*|0)(\\.\\d+)?$/" required="" type="text" /
  span.text-error ng-show="newForm['price[hoge]'].$error.required"  ※
  span.text-error ng-show="newForm['price[hoge]'].$error.pattern"  This is not a valid dollar.
</code></pre>

<p>formのnameに指定されいるものを[]とシングルクォートで囲むといけます。</p>
]]></content>
    </entry>
    
    <entry>
        <title type="html"><![CDATA[Rails 便利なテクニック その１]]></title>
        <link href="http://yoshitsugufujii.github.io/blog/2016/02/18/rails-tips-1/"/>
        <updated>2016-02-18T11:33:58+09:00</updated>
        <id>http://yoshitsugufujii.github.io/blog/2016/02/18/rails-tips-1</id>
        <content type="html"><![CDATA[<p>日常コード書いてて便利だなぁと思った技とかを思い出したら不定期に書いていきます。</p>

<p>よくメニューをulとliを使ってタブで表示することがあると思います。<br/>
例えばタブは以下の条件で表示されます</p>

<ul>
<li>ユーザの年齢が20歳以上なら表示するタブA</li>
<li>ユーザの性別が男性なら表示するタブB</li>
<li>ユーザの性別が女性なら表示するタブC</li>
<li>ユーザの性別が男性でかつ20歳以上なら表示するタブD</li>
</ul>


<p>実装が終わって総合テストがはじまります。</p>

<p>ここでチケットがあがってきます。</p>

<p><strong>『タブが一つしか出力されない場合はタブを非表示にしてください。』</strong></p>

<p>さてどうしましょう？</p>

<!-- more -->


<p>複雑なif文を組み合わせてタブが１つかでない条件を見つけ出して非表示にしますか？<br/>
タブが増えたり条件が増えたりしたら大変な上に可読性悪そうですね。</p>

<p>Railsには便利なcaptureというメソッドがあります。<br/>
これはcaptureメソッドに与えられたブロックの出力内容を返すメソッドです。<br/>
これを使うとシンプルに問題を解決できます。</p>

<pre><code class="erb app/views/layout/tab.html.erb">&lt;% tab = capture do %&gt;
  &lt;ul&gt;
    &lt;% if user.age &gt;= 20 %&gt; 
      &lt;li&gt;タブA&lt;/li&gt;
    &lt;% end %&gt;

    &lt;% if user.male? %&gt; 
      &lt;li&gt;タブB&lt;/li&gt;
    &lt;% end %&gt;

    &lt;% if user.female? %&gt; 
      &lt;li&gt;タブC&lt;/li&gt;
    &lt;% end %&gt;

    &lt;% if user.male? &amp;&amp; user.age &gt;= 20 %&gt; 
      &lt;li&gt;タブD&lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;

&lt;% # tabが一個ならば表示しない %&gt;
&lt;%= tab.scan("&lt;/li&gt;").count &gt; 1 ? tab : "" %&gt;
</code></pre>

<p>htmlを動的に組み立てる際にあれこれするよりも、出力されたhtmlをもとに処理するというケースの方が圧倒的にスマートなケースがあるので積極的に使っていきたいですね。</p>
]]></content>
    </entry>
    
</feed>
